@use "sass:list";
@use "sass:meta";
@use "sass:string";

/// Used to create a selector from context() arguments
///
/// @param {(string|list)} $block - The name of the module/component that has the context
/// @param {string} $context - The context you wish to test
/// @param {bool} $pipeContexts
@function create-context-selector($block, $context: null, $pipeContexts: false) {
  $selector: ();
  $pipedContexts: '';
  $excludeRootSelector: false;

  @if $context == '' {
    $context: null;
  }

  @if $pipeContexts {
    @each $item in $context {
      @if string.index($item, ':') == 1 {
        $pipedContexts: $pipedContexts + $item;
      }
      @else {
        $excludeRootSelector: true;
        $pipedContexts: $pipedContexts + '[class*="#{$modifierGlue}#{$item}"]';
      }
    }
    @if meta.type-of($block) == 'string' and not $excludeRootSelector {
      $selector: '.#{$block}#{$pipedContexts}, [class*=".#{$block}#{$modifierGlue}"]#{$pipedContexts}';
    }
    @else {
      $selector: '#{generate-chunk($block)}#{$pipedContexts}';
    }
  }

  @else {
    @if $context {
      @each $item in $context {
        @if string.index($item, ':') == 1 {
          @if meta.type-of($block) == 'string' {
            $selector: list.append($selector, '.#{$block}#{$item}', comma);
          }
          $selector: list.append($selector, '#{generate-chunk($block)}#{$item}', comma);
        }
        @else {
          $selector: list.append($selector, '#{generate-chunk($block)}[class*="#{$modifierGlue}#{$item}"]', comma);
        }
      }
    }
    @else {
      @if meta.type-of($block) == 'string' {
        $selector: list.append($selector, '.#{$block}', comma);
        $selector: list.append($selector, '[class*=".#{$block}#{$modifierGlue}"]', comma);
      }
      @else {
        $selector: list.append($selector, generate-chunk($block), comma);
      }
    }
  }

  @return $selector;
}

/// Generate a selector chunk from a $block list
///
/// @param {(string|list)} $block
@function generate-chunk($block) {
  $chunk: '';

  @if meta.type-of($block) == 'list' {
    @for $i from 1 through list.length($block) {
      @if $i == 1 {
        $chunk: $chunk + '[class*=".#{list.nth($block, $i)}#{$componentGlue}"]';
      }
      @else {
        $chunk: $chunk + '[class*="#{$componentGlue}#{list.nth($block, $i)}"]';
      }
    }
  }
  @else {
    $chunk: '[class*=".#{$block}#{$modifierGlue}"]';
  }

  @return $chunk;
}