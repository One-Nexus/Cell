/// Create a component based off the main module
///
/// @param {string|list} $components - The component or components to be used
/// @param {map} $content
/// @param {bool} $sub-component
/// @param {string} $glue
/// @param {bool} $cascade
@mixin component(
  $components: null,
  $content: (),
  $sub-component: false,
  $glue: $componentGlue,
  $cascade: true
) {
  $this: &;
  $namespace: get-module-name($this);
  $selectors: '[class*=".#{$module}#{$glue}"]';
  $parents: ();

  @if $sub-component {
    $namespace: get-namespace(&);
  }

  @if $components {
    $selectors: ();

    @each $component in $components {
      $selector: '.#{$namespace}#{$glue}#{$component}, [class*=".#{$namespace}#{$glue}#{$component}#{$modifierGlue}"]';

      @if not $cascade {
        $selector: '> #{$selector}';
      }

      $selectors: join($selectors, $selector, comma);
    }
  }

  @each $selector in & {
    // spoof the selector into a list
    $selector: selector-parse(str-replace(#{$selector}, ' ', ', '));

    $last-item: nth($selector, length($selector));
    $is-modifier: str-index(#{$last-item}, '[class*="#{$modifierGlue}');
    $is-pseudo-state: str-index(#{$last-item}, ':');

    @if not ($is-modifier or $is-pseudo-state) {
      $selector: list-remove($selector, $last-item);
    }

    @debug $selector;

    // Re-build the parent selector
    @if length($selector) > 0 {
      $parents: append($parents, str-replace(#{$selector}, ', ', ' '), comma);
    }
  }

  $parents: list-remove-duplicates($parents);

  @if length($parents) == 0 {
    @at-root #{$selectors} {
      @content;

      @include parse-cq($content);
    }
  }
  @else {
    @at-root #{$parents} {
      #{$selectors} {
        @content;

        @include parse-cq($content);
      }
    }
  }
}

/// Alis for `component` mixin with $sub-component: true
///
/// @param {string|list} $components
/// @param {map} $content
/// @param {string} $glue
@mixin sub-component($components: null, $content: (), $glue: $componentGlue) {
  @include component($components, $content, true, $glue) {
    @content;
  }
}

/// Alias for component() mixin
///
/// @author [@esr360](http://twitter.com/esr360)
/// @access public
@mixin components($args...) {
  @include component($args...) {
    @content;
  }
}